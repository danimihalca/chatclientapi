project(chatClientAPI)
cmake_minimum_required(VERSION 2.8)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DASIO_STANDALONE")

MESSAGE(STATUS "TARGET SYSTEM:" ${CMAKE_SYSTEM_NAME})
MESSAGE(STATUS "BUILD TYPE:" ${CMAKE_BUILD_TYPE})

find_package (Threads)

INCLUDE_DIRECTORIES($ENV{WEBSOCKETPP_LIBRARY_PATH})
INCLUDE_DIRECTORIES($ENV{ASIO_LIBRARY_PATH})
INCLUDE_DIRECTORIES(inc)

SET (HEADER_FILES inc/common.h
                  inc/IChatClient.h
                  inc/ChatClient.h
                  inc/ChatClientImpl.h)
SET (SOURCE_FILES src/ChatClient.cpp
                  src/ChatClientImpl.cpp)
SET (LIBRARIES ${CMAKE_THREAD_LIBS_INIT})

add_library(${PROJECT_NAME} SHARED ${HEADER_FILES} ${SOURCE_FILES})
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${LIBRARIES})


SET (PUBLIC_HEADERS ${PROJECT_SOURCE_DIR}/inc/IChatClient.h
                    ${PROJECT_SOURCE_DIR}/inc/ChatClient.h
                    ${PROJECT_SOURCE_DIR}/inc/common.h)
SET(HEADER_DESTINATION_PATH $ENV{DEPLOY_PATH}/inc/${PROJECT_NAME})

if(${CMAKE_SYSTEM_NAME} MATCHES "Android")
    MESSAGE(STATUS "ANDROID API:" ${ANDROID_NATIVE_API_LEVEL})
    MESSAGE(STATUS "ANDROID ABI:" ${ANDROID_ABI})

    SET( LIBRARY_DESTINATION_PATH $ENV{DEPLOY_PATH}/lib/${CMAKE_BUILD_TYPE}/android/${ANDROID_NATIVE_API_LEVEL}/${ANDROID_ABI})
elseif(${CMAKE_SYSTEM_NAME} MATCHES "Linux")
    SET( LIBRARY_DESTINATION_PATH $ENV{DEPLOY_PATH}/lib/${CMAKE_BUILD_TYPE}/linux)
endif()

INSTALL(TARGETS ${PROJECT_NAME} DESTINATION ${LIBRARY_DESTINATION_PATH})
INSTALL(FILES ${PUBLIC_HEADERS} DESTINATION ${HEADER_DESTINATION_PATH})
